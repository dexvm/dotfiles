{{ if (eq .chezmoi.os "linux") -}}
#!{{ lookPath "bash" }}

set -eufo pipefail

echo "Installing fish shell..."

# Installing fish
{{ if (eq .chezmoi.osRelease.id "ubuntu") -}}
ppa_repo_source=fish-shell/release-3
if ! $(apt-cache policy | grep http | awk '{print $2}' | sort -u | grep $ppa_repo_source &> /dev/null); then
  echo "adding ppa:$ppa_repo_source repository to apt"
  sudo add-apt-repository -y ppa:$ppa_repo_source
fi
if ! $(dpkg-query -W -f='installed' fish &> /dev/null); then
  echo "installing fish"
  sudo apt install -y fish
fi

{{ else if eq .chezmoi.osRelease.id "arch" -}}
if [ "$(pacman -Qq fish 2> /dev/null)" != fish ]; then
  echo "installing fish"
  sudo pacman -S --noconfirm fish
fi
{{ end -}}

echo "Finished installing up fish shell"
{{ end -}}

